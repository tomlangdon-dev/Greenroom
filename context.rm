Greenroom â€” Project Context

What It Is

A local-first web app (Mac) for managing video assets and Brainsuite AI test results. Built for a creative agency producer. Single-user for now, cloud deployment planned.

Tech Stack

Backend: Python + Flask
Database: SQLite (via database.py)
Frontend: Single HTML file â€” vanilla JS, no frameworks
Launcher: python3 launch.py
URL: http://127.0.0.1:5000 (not localhost â€” Safari quirk on managed Mac)
File Structure



CampaignManager/
â”œâ”€â”€ app.py                  â† Flask server + all API routes
â”œâ”€â”€ database.py             â† SQLite schema + connection
â”œâ”€â”€ database.db             â† Live database
â”œâ”€â”€ launch.py               â† App launcher
â”œâ”€â”€ repair.py               â† Reusable Python file rebuilder
â”œâ”€â”€ requirements.txt        â† flask only
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ index.html          â† Entire frontend (HTML/CSS/JS)
â”œâ”€â”€ static/
â”‚   â””â”€â”€ bg.mp4              â† Home page hero background video
â””â”€â”€ uploads/
  â”œâ”€â”€ videos/             â† Copies of uploaded video files
  â””â”€â”€ pptx/               â† Copies of uploaded PPTX reports
Backend â€” All Current Routes (app.py)

Route	Method	Purpose
/	GET	Serves index.html
/uploads/videos/<filename>	GET	Serves video files
/api/folders	GET	List all folders
/api/folders	POST	Create folder {name, parent_id, is_managed, brainsuite_test, cta, file_type}
/api/folders/<id>	PUT	Rename folder
/api/folders/<id>	DELETE	Hard-delete folder + all contained assets + files (recursive)
/api/folders/<id>/count	GET	Count assets recursively in folder
/api/folders/<id>/config	GET	Get project config JSON
/api/folders/<id>/config	PUT	Save project config JSON
/api/assets	GET	List assets â€” supports ?folder_id=X or ?project_id=X (recursive)
/api/assets/<id>	DELETE	Hard-delete asset + files
/api/assets/<id>	PUT	Move asset to folder {folder_id}
/api/assets/<id>/tags	PUT	Update metadata
/api/versions/<asset_id>	GET	List versions for asset
/api/upload	POST	Upload video + optional PPTX
/api/versions/<id>/report	POST	Pair report with existing version
/api/tags	GET	Get all distinct audience tags ?project_id=X
/api/projects/stats	GET	Asset counts + score distribution per project
Database Schema

sql


folders   â€” id, name, parent_id (CASCADE on delete), created_at,
          is_managed (0/1), config (JSON), brainsuite_test (TEXT),
          cta (INTEGER), file_type (TEXT DEFAULT 'video')

assets    â€” id, folder_id (SET NULL on delete), base_name,
          display_name, phase, platform, format,
          is_master (0/1), audience_tags (JSON),
          content_origin (TEXT DEFAULT 'Brand'), language (TEXT),
          created_at

versions  â€” id, asset_id (CASCADE), version_number,
          video_filename, video_path, pptx_filename, pptx_path,
          ace_score, kpi_data (JSON), asset_info (JSON),
          thumbnail (base64), duration (INTEGER), is_latest, uploaded_at
Project Config JSON

Stored in folders.config for root-level folders only:

json


{
"identity": {
  "company": "Unilever",
  "brand": "Dove",
  "market": "USA",
  "businessGroup": "Personal Care",
  "category": "Deodorants",
  "defaultLanguage": "English",
  "additionalLanguages": ["Spanish"]
},
"org": {
  "phases": ["Reach", "Action"],
  "audiences": ["18-34", "Hispanic"]
},
"phaseChannels": {
  "Reach": [
    {
      "name": "Meta",
      "formats": [
        {"name": "Story", "test": "Instagram Story", "cta": true, "enabled": true},
        {"name": "Feed", "test": "Instagram Feed", "cta": true, "enabled": true}
      ],
      "enabled": true
    },
    {"name": "OLV 15", "test": "YouTube In-Stream", "cta": false, "enabled": true},
    {"name": "TikTok", "test": "TikTok", "cta": true, "enabled": true}
  ],
  "Action": [...]
}
}
Hardcoded for all Brainsuite submissions: assetStage: "Iteration", assetOrigin: "Global (BG)"

Frontend â€” Feature Overview

Home / Landing Page

Full-bleed hero (50vh) with video background (/static/bg.mp4), dark overlay, large centered Greenroom logo + wordmark
As user scrolls, content slides over the sticky hero
At 40% scroll threshold a compact header drops in from the top (logo + no buttons)
Below the hero: Projects title row with + New Project button, then project cards grid
Main app header (.hdr) is hidden on home view, restored on project entry
Project cards show score distribution bar + counts. Right-click â†’ Edit Brief / Rename / Delete.
Navigation Structure

Home â†’ project overview â†’ folder â†’ detail view
No browser history API wiring yet (backlog)
Sidebar (within project)

Overview link (SVG home icon) â†’ project overview
Separator + FOLDERS label
Folder tree â€” collapsible, top-level folders prominent
Managed folders: no âœï¸ğŸ—‘ on hover, right-click â†’ "Edit via Project Settings"
Unmanaged folders: fully editable
â† All Projects â†’ home
Project Setup Modal (3 steps)

Step 1 â€” Identity: Company (Unilever/Competitor pills), Brand, Market, Business Group, Category, Default Language, Additional Languages
Step 2 â€” Organisation: Phases (common pills + freetext), Audiences (pill input)
Step 3 â€” Channels: per-phase platform/format selection, pre-populated from DEFAULT_CHANNELS, inline format sub-options
On save (new): config written to DB, managed folder tree auto-generated
On save (edit): disabled channels removed (with asset-count warning), new channels created, existing unchanged, sidebar + grid refreshed via loadAssets()
Accessible via: + New Project, project card right-click â†’ Edit Brief, overview âš™ï¸ Edit Brief button, managed folder right-click â†’ Edit via Project Settings
Managed vs Unmanaged Folders

Managed (is_managed=1): created by project setup, no rename/delete in UI
Unmanaged: user-created via + Add Folder button in header (non-overview views only)
Add Folder triggers inline input card injected into the folders section of the grid
Enter saves, Escape cancels, input appears contextually where folders live
Test config inheritance: walk up tree to first managed folder with brainsuite_test set
Overview Page

Sticky header: project name + score bands + filter bar (hidden when project empty)
Score bands: fully rounded, handles single-segment correctly (:only-child fix)
Filters: All / Not Green / Green / Amber / Red / Unscored
Assets grouped by folder path, Untagged group at bottom
Masters sort to front of each group
âš™ï¸ Edit Brief button in header
Empty project: light empty state message, no filter bar shown
Folder Grid View

Folders always on top in .folders-section, assets always below in .assets-section â€” never share rows
Masters sort to front of asset section
Empty folder: light empty state message
Upload file name truncates with ellipsis in upload modal
Asset Cards

Thumbnail (from PPTX or auto-generated from video at 20% mark)
Duration displayed
Hover to scrub video preview
ACE score badge, MASTER badge
Right-click: Add Report (if unscored) / Move to folder / Delete
Drag onto folder cards to move
Tagging Modal

Triggered on first upload. Skipped for version uploads.
In managed folder: phase/platform/format hidden, blue banner shows test config
Outside managed folder: full manual tagging from project config
Audience: single-select pills from project config
Content origin (Brand/Creator), language (if project has additional languages)
On confirm: metadata saved, asset auto-moved to correct managed folder
Edit button in detail view re-opens pre-filled
Detail / Player View

Native browser video controls (replacement planned â€” see backlog)
Version dropdown, meta bar, ACE score panel with collapsible KPI categories
Add/Replace Report button
Score System

Green â‰¥67, Amber 34â€“66, Red <34
Weighted: Branding Ã—5, Attention Ã—3, Processing/Emotional/Persuasion Ã—1
Key Design Decisions

Projects = top-level folders (no separate projects table)
Project config stored as JSON in folders.config on root folder
Folder structure IS the brief â€” auto-generated from channel config
Tagging drives location â€” asset auto-moves to correct managed folder on confirm
Versions: same filename = new version, different filename = new asset
Display name separate from base_name (filename)
All uploads are file copies in uploads/. Safe to hard-delete.
content_origin defaults to Brand; surfaces at per-asset level only
Language hidden in tagging modal unless project has additional languages
API Readiness getBrainsuiteTestConfig(assetId) â€” walks folder tree, assembles complete Brainsuite submission payload. Returns null for non-testable assets. Ready to wire when API available.

Code Delivery (Important for Future Sessions)

HTML files â†’ send as standalone code block â†’ renders as artifact â†’ use code view tab â†’ copy â†’ paste into templates/index.html
Python files â†’ use repair.py with S = chr(32)*4, S2 = chr(32)*8, N = chr(10)
VS Code is the editor. Python 3.14.3. Managed corporate Mac â€” python3 only, no shell scripts
DB migrations use list comprehension: [conn.execute("ALTER TABLE...") for c,d in new_cols if c not in existing]
Targeted JS patches preferred over full HTML regeneration where possible (token efficiency)
JS Code Landmarks for Patch Placement

"utility/helper functions" â†’ block containing formatDuration(), checkPair(), generateVideoThumbnail(), calcACE(), sortedByMaster() â€” above init()
"state variables" â†’ var state = {...} block at top of script
"context menu functions" â†’ showCtx() / hideCtx() / showProjCtx() block
"sidebar rendering" â†’ renderSidebar(), makeRow(), addFolder()
"overview/grid rendering" â†’ renderOverview(), renderGrid(), makeCard(), makeFolderCard()
"tag modal functions" â†’ showTagModal(), renderTagModal(), submitTags()
"project setup functions" â†’ // === PROJECT SETUP MODAL === block
Related Tools

AutoBS (Chrome extension) Automates Brainsuite upload form. Captures ACE scores, category scores, KPI data from live results page. Defines exact field values and valid options Brainsuite accepts â€” authoritative reference for future constrained field implementation in project setup.

BrainSurgeon (web app) Parses Brainsuite PPTX reports. parsePPTX() and all supporting logic embedded directly in index.html.

Deferred / Backlog

Item	Notes
Video player controls + inline comments	Native browser controls are visually heavy. Build a custom lightweight playbar â€” natural anchor for timecode-based comments. Comment markers on scrub bar, click to jump and read/add. Replaces native controls entirely. Multi-user commenting unlocks with cloud deployment; single-user timestamped notes useful before that.
futureTests array in DEFAULT_CHANNELS	Dormant scaffolding for multi-test platforms (e.g. Meta Story â†’ Instagram Story + Facebook Story). Defer to API session â€” shape may change once real API is known.
Brainsuite field validation	Business Group, Category, Market, Brand, Language should use constrained dropdowns matching Brainsuite's accepted values. Source of truth: AutoBS field definitions. Defer to API session.
Brainsuite API integration	Auto-submit test on upload to managed folder. Use getBrainsuiteTestConfig() as payload builder. Poll for results, auto-pair when ready (~10 mins).
Browser back button	No history.pushState() calls â€” browser has no navigation history. Fix: call pushState at each navigation point (home, project, folder, detail), listen for popstate to reverse. Moderate effort.
Batch upload	Multiple files selected at once. Display creative typically arrives in sets (MPU, Leader, Sky) â€” good primary use case. Solution TBD.
Auto-launcher	Wrap python3 launch.py in Automator app, add to Login Items
Sidebar drag-to-folder	Drag asset cards onto sidebar folders (grid folder cards only currently)
Folder drag	Pick up entire folders for mass moves
Cloud/remote deployment	Private server, always-on, multi-user, bypasses SharePoint blocker
Sort controls	By name, date, ACE score
Download	Single asset + project-level zip preserving folder structure
Version ACE delta	â†‘/â†“ indicator vs previous version
Version stacking â€” fuzzy match	Handle _v2 suffix not creating a new asset
Stage 2 filter extensions	Filter by platform, phase, format, master status
List view toggle	Alternative to card grid for dense folders
Display asset support	HTML5 upload + framed playback (Path 1) or video proxy (Path 2) â€” deferred
Static/image asset support	JPG/PNG for Meta/Pinterest statics alongside video
Cohorts	Concept undefined â€” needs a conversation before building
Comments (simple)	Text notes on versions; upgrades to timestamped playhead comments when custom player built
