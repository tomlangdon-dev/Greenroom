Greenroom â€” Project Context

What It Is

A local-first web app (Mac) for managing video assets and Brainsuite AI test results. Built for a creative agency producer. Single-user for now, cloud deployment planned.

Tech Stack

Backend: Python + Flask
Database: SQLite (via database.py)
Frontend: Single HTML file â€” vanilla JS, no frameworks
Launcher: python3 launch.py
URL: http://127.0.0.1:5000 (not localhost â€” Safari quirk on managed Mac)
File Structure



CampaignManager/
â”œâ”€â”€ app.py                  â† Flask server + all API routes
â”œâ”€â”€ database.py             â† SQLite schema + connection
â”œâ”€â”€ database.db             â† Live database
â”œâ”€â”€ launch.py               â† App launcher
â”œâ”€â”€ repair.py               â† Reusable Python file rebuilder
â”œâ”€â”€ requirements.txt        â† flask only
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ index.html          â† Entire frontend (HTML/CSS/JS)
â””â”€â”€ uploads/
  â”œâ”€â”€ videos/             â† Copies of uploaded video files
  â””â”€â”€ pptx/               â† Copies of uploaded PPTX reports
Backend â€” All Current Routes (app.py)

Route	Method	Purpose
/	GET	Serves index.html
/uploads/videos/<filename>	GET	Serves video files
/api/folders	GET	List all folders
/api/folders	POST	Create folder {name, parent_id, is_managed, brainsuite_test, cta, file_type}
/api/folders/<id>	PUT	Rename folder
/api/folders/<id>	DELETE	Hard-delete folder + all contained assets + files (recursive)
/api/folders/<id>/count	GET	Count assets recursively in folder
/api/folders/<id>/config	GET	Get project config JSON
/api/folders/<id>/config	PUT	Save project config JSON
/api/assets	GET	List assets â€” supports ?folder_id=X or ?project_id=X (recursive)
/api/assets/<id>	DELETE	Hard-delete asset + files
/api/assets/<id>	PUT	Move asset to folder {folder_id}
/api/assets/<id>/tags	PUT	Update metadata
/api/versions/<asset_id>	GET	List versions for asset
/api/upload	POST	Upload video + optional PPTX
/api/versions/<id>/report	POST	Pair report with existing version
/api/tags	GET	Get all distinct audience tags ?project_id=X
/api/projects/stats	GET	Asset counts + score distribution per project
Database Schema

sql


folders   â€” id, name, parent_id (CASCADE on delete), created_at,
          is_managed (0/1), config (JSON), brainsuite_test (TEXT),
          cta (INTEGER), file_type (TEXT DEFAULT 'video')

assets    â€” id, folder_id (SET NULL on delete), base_name,
          display_name, phase, platform, format,
          is_master (0/1), audience_tags (JSON),
          content_origin (TEXT DEFAULT 'Brand'), language (TEXT),
          created_at

versions  â€” id, asset_id (CASCADE), version_number,
          video_filename, video_path, pptx_filename, pptx_path,
          ace_score, kpi_data (JSON), asset_info (JSON),
          thumbnail (base64), duration (INTEGER), is_latest, uploaded_at
Project Config JSON

Stored in folders.config for root-level folders only:

json


{
"identity": {
  "company": "Unilever",
  "brand": "Dove",
  "market": "USA",
  "businessGroup": "Personal Care",
  "category": "Deodorants",
  "defaultLanguage": "English",
  "additionalLanguages": ["Spanish"]
},
"org": {
  "phases": ["Reach", "Action"],
  "audiences": ["18-34", "Hispanic"]
},
"phaseChannels": {
  "Reach": [
    {
      "name": "Meta",
      "formats": [
        {"name": "Story", "test": "Instagram Story", "cta": true, "enabled": true},
        {"name": "Feed", "test": "Instagram Feed", "cta": true, "enabled": true}
      ],
      "enabled": true
    },
    {"name": "OLV 15", "test": "YouTube In-Stream", "cta": false, "enabled": true},
    {"name": "TikTok", "test": "TikTok", "cta": true, "enabled": true}
  ],
  "Action": [...]
}
}
Hardcoded for all Brainsuite submissions: assetStage: "Iteration", assetOrigin: "Global (BG)"

Frontend â€” Feature Overview

Navigation Structure

Home: Project picker cards with score distribution bars. Right-click â†’ Edit Brief / Rename / Delete.
Project â†’ Overview (project root): Sticky header with project name + score bands + filter bar + âš™ï¸ Edit Brief button. Assets grouped by folder path with section dividers.
Project â†’ Sub-folder: Normal grid view with folder cards + asset cards.
Detail/player view: Video player + ACE scores panel.
Sidebar (within project)

Overview link (SVG home icon) â†’ project overview
Separator + FOLDERS label
Folder tree â€” collapsible, top-level folders prominent
Managed folders: no âœï¸ğŸ—‘ on hover, right-click â†’ "Edit via Project Settings"
Unmanaged folders: fully editable as normal
â† All Projects â†’ home
Project Setup Modal (3 steps)

Step 1 â€” Identity: Company (Unilever/Competitor pills), Brand, Market, Business Group, Category, Default Language, Additional Languages (pill input)
Step 2 â€” Organisation: Phases (common pills + freetext), Audiences (pill input)
Step 3 â€” Channels: Per-phase platform/format selection with checkboxes. Pre-populated from DEFAULT_CHANNELS. Inline format sub-options for multi-format platforms.
On save: config written to DB, managed folder tree auto-generated. On edit: disabled channels removed (with asset-count warning), new channels created, existing unchanged.
Accessible via: + New Project button, project card right-click â†’ Edit Brief, overview âš™ï¸ Edit Brief button, managed folder right-click â†’ Edit via Project Settings.
Managed vs Unmanaged Folders

Managed (is_managed=1): created by project setup, tied to config. No rename/delete in UI. Right-click routes to project settings.
Unmanaged: user-created via + New Folder. Fully editable. Can be nested inside managed folders for organisation â€” inherits test config from nearest managed ancestor.
Test config inheritance: walk up tree until first managed folder with brainsuite_test set. Unmanaged layers are invisible to Brainsuite.
Overview Page

Sticky header: project name + score bands (fully rounded, handles single-segment correctly) + filter bar
Filters: All / Not Green / Green / Amber / Red / Unscored
Assets grouped by folder path (e.g. REACH â€” META â€” STORY), Untagged group at bottom
âš™ï¸ Edit Brief button in header
Asset Cards

Thumbnail (from PPTX or auto-generated from video frame at 20% mark)
Duration displayed on card
Hover to scrub video preview
ACE score badge, MASTER badge
Right-click: Add Report (if unscored) / Move to folder / Delete
Drag onto folder cards to move
Tagging Modal

Triggered on first upload of any asset. Skipped for version uploads.
Video autoplays silently in left panel
In managed folder: Phase/platform/format pills hidden. Blue banner shows "ğŸ“ Will test as: Instagram Story". Only asks for display name, content origin (Brand/Creator), language (if project has additional languages), master toggle, audience.
Outside managed folder: Full manual tagging â€” phase/platform pills from project config, formats filtered by selected platform, hidden for single-format platforms.
Audience: single-select pills from project-defined audiences list.
Confirm locked until phase + platform resolved (either from context or manual selection).
On confirm: asset metadata saved, auto-moved to correct managed folder via findTargetFolder().
Edit button in detail view re-opens pre-filled modal.
Detail/Player View

Back â†’ grid/overview
Display name prominent, filename secondary in grey if renamed
Version dropdown
Meta bar: all tags + date + âœï¸ Edit
Video player + ACE score panel with collapsible category KPIs
Add/Replace Report button
Score Bands

Green â‰¥67, Amber 34â€“66, Red <34
Weighted: Branding Ã—5, Attention Ã—3, Processing/Emotional/Persuasion Ã—1
Key Design Decisions

Projects = top-level folders (no separate projects table)
Project config stored as JSON in folders.config on root folder
Folder structure IS the brief â€” auto-generated from channel config
Tagging drives location â€” asset auto-moves to correct folder on tag confirm
Versions: same filename = new version, different filename = new asset
Display name separate from base_name (filename)
All uploads are file copies in uploads/. Safe to hard-delete.
content_origin defaults to Brand; surfaces at per-asset level only
Language hidden in tagging modal unless project has additional languages defined
API Readiness getBrainsuiteTestConfig(assetId) â€” walks folder tree to find test config, assembles complete Brainsuite submission payload including all project-level identity fields. Returns null for non-testable assets (Pinterest, Display, unmanaged folders). Ready to wire to API when available.

Code Delivery (Important for Future Sessions)

HTML files â†’ send as standalone code block â†’ renders as artifact â†’ use code view tab â†’ copy â†’ paste into templates/index.html
Python files â†’ use repair.py with S = chr(32)*4, S2 = chr(32)*8, N = chr(10)
VS Code is the editor. Python 3.14.3. Managed corporate Mac â€” python3 only, no shell scripts.
DB migrations use list comprehension: [conn.execute("ALTER TABLE...") for c,d in new_cols if c not in existing]
Targeted JS patches preferred over full HTML regeneration where possible (token efficiency)
Related Tools

AutoBS (Chrome extension) Automates Brainsuite upload form. Captures ACE scores, category scores, KPI data from live results page. Defines the exact field values and valid options Brainsuite accepts â€” authoritative reference for any future constrained field implementation in project setup.

BrainSurgeon (web app) Parses Brainsuite PPTX reports. The parsePPTX() function and all supporting logic embedded directly in index.html.

Deferred / Backlog

Item	Notes
futureTests array in DEFAULT_CHANNELS	Dormant scaffolding for multi-test platforms (e.g. Meta Story â†’ Instagram Story + Facebook Story). Defer to API session â€” shape may change once real API is known.
Brainsuite field validation	Business Group, Category, Market, Brand, Language should use constrained dropdowns matching Brainsuite's accepted values. Source of truth: AutoBS field definitions. Defer to API session.
Brainsuite API integration	Auto-submit test on upload to managed folder. Use getBrainsuiteTestConfig() as payload builder. Poll for results, auto-pair when ready (~10 mins).
Auto-launcher	Wrap python3 launch.py in Automator app, add to Login Items
Sidebar drag-to-folder	Drag asset cards onto sidebar folders (grid folder cards only currently)
Folder drag	Pick up entire folders for mass moves
Cloud/remote deployment	Private server, always-on, multi-user, bypasses SharePoint blocker
Sort	By name, date, ACE score
Download	Single asset + project-level zip preserving folder structure
Simple comments	Text notes on versions; upgrades to timestamped playhead comments when cloud arrives
Version ACE delta	â†‘/â†“ indicator vs previous version
Version stacking â€” fuzzy match	Handle _v2 suffix not creating a new asset
Cohorts	Concept not yet defined â€” revisit
Stage 2 filter extensions	Filter by platform, phase, format, master status
List view toggle	Alternative to card grid for dense folders
Display asset support	HTML5 upload + framed playback (Path 1, separate project) or video proxy (Path 2, low effort if render pipeline exists)
Static/image asset support	JPG/PNG for Meta/Pinterest statics alongside video
