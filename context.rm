
My thought process
Greenroom â€” Master Context (Sessions 1 & 2)

What It Is
A local-first web app (Mac) for managing video assets and Brainsuite AI test results. Built for a creative agency producer. Single-user for now, cloud deployment planned.

Tech Stack
Backend: Python + Flask
Database: SQLite (via database.py)
Frontend: Vanilla JS, no frameworks â€” split across static files
Launcher: python3 launch.py
URL: http://127.0.0.1:5000 (not localhost â€” Safari quirk on managed Mac)
File Structure


CampaignManager/
â”œâ”€â”€ app.py                  â† Flask server + all API routes
â”œâ”€â”€ database.py             â† SQLite schema + connection
â”œâ”€â”€ database.db             â† Live database (gitignored)
â”œâ”€â”€ launch.py               â† App launcher
â”œâ”€â”€ repair.py               â† Reusable Python file rebuilder
â”œâ”€â”€ requirements.txt        â† flask only
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ index.html          â† HTML shell only (no inline CSS or JS)
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ main.css        â† All styles
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â””â”€â”€ app.js          â† All JavaScript
â”‚   â”œâ”€â”€ bg.mp4              â† Hero background video
â”‚   â”œâ”€â”€ greenroomfavi.png   â† Favicon 64Ã—64
â”‚   â””â”€â”€ greenroomfavi1024.png â† Apple touch icon 1024Ã—1024
â””â”€â”€ uploads/                â† Legacy path (kept for compatibility)
  â”œâ”€â”€ videos/
  â””â”€â”€ pptx/
Media storage: ~/Documents/GreenroomMedia/projects/{id}_{name}/videos|pptx/ â€” organised by project at upload time.

Backend â€” All Routes
Route	Method	Purpose
/	GET	Serves index.html
/api/media/<version_id>	GET	Serves video by version ID via absolute path
/uploads/videos/<filename>	GET	Legacy video serving (kept for compatibility)
/api/folders	GET	List all folders
/api/folders	POST	Create folder {name, parent_id, is_managed, brainsuite_test, cta, file_type}
/api/folders/<id>	PUT	Rename folder
/api/folders/<id>	DELETE	Hard-delete folder + all contained assets + files (recursive)
/api/folders/<id>/count	GET	Count assets recursively in folder
/api/folders/<id>/config	GET	Get project config JSON
/api/folders/<id>/config	PUT	Save project config JSON
/api/assets	GET	List assets â€” supports ?folder_id=X or ?project_id=X (recursive)
/api/assets/<id>	DELETE	Hard-delete asset + files
/api/assets/<id>	PUT	Move asset to folder {folder_id}
/api/assets/<id>/tags	PUT	Update metadata
/api/assets/<id>/status	PUT	Set review status {status}
/api/versions/<asset_id>	GET	List versions for asset
/api/versions/<id>/report	POST	Pair report with existing version
/api/versions/<vid>/comments	GET	List comments for version
/api/versions/<vid>/comments	POST	Add comment {text, timecode}
/api/comments/<cid>	DELETE	Delete comment
/api/upload	POST	Upload video + optional PPTX
/api/tags	GET	Get all distinct audience tags ?project_id=X
/api/projects/stats	GET	Asset counts + score distribution per project
Database Schema
sql


folders   â€” id, name, parent_id (CASCADE on delete), created_at,
          is_managed (0/1), config (JSON), brainsuite_test (TEXT),
          cta (INTEGER), file_type (TEXT DEFAULT 'video')

assets    â€” id, folder_id (SET NULL on delete), base_name,
          display_name, phase, platform, format,
          is_master (0/1), audience_tags (JSON),
          content_origin (TEXT DEFAULT 'Brand'), language (TEXT),
          review_status (TEXT DEFAULT 'unreviewed'),
          created_at

versions  â€” id, asset_id (CASCADE), version_number,
          video_filename, video_path, pptx_filename, pptx_path,
          ace_score, kpi_data (JSON), asset_info (JSON),
          thumbnail (base64), duration (INTEGER), is_latest,
          uploaded_at

comments  â€” id, version_id (CASCADE), timecode (REAL),
          text (TEXT), created_at
Assets query returns additionally (via JOIN): ace_score, asset_info, thumbnail, uploaded_at, latest_version, latest_version_id, video_filename, duration, review_status, content_origin, language, comment_count (subquery counting comments on latest version only).

Review status values: unreviewed | needs_attention | reviewed | approved

Project Config JSON
Stored in folders.config for root-level folders only:

json


{
"identity": {
  "company": "Unilever",
  "brand": "Dove",
  "market": "USA",
  "businessGroup": "Personal Care",
  "category": "Deodorants",
  "defaultLanguage": "English",
  "additionalLanguages": ["Spanish"]
},
"org": {
  "phases": ["Reach", "Action"],
  "audiences": ["18-34", "Hispanic"]
},
"phaseChannels": {
  "Reach": [
    {
      "name": "Meta",
      "formats": [
        {"name": "Story", "test": "Instagram Story", "cta": true, "enabled": true},
        {"name": "Feed", "test": "Instagram Feed", "cta": true, "enabled": true}
      ],
      "enabled": true
    },
    {"name": "OLV 15", "test": "YouTube In-Stream", "cta": false, "enabled": true},
    {"name": "TikTok", "test": "TikTok", "cta": true, "enabled": true}
  ]
}
}
Hardcoded for all Brainsuite submissions: assetStage: "Iteration", assetOrigin: "Global (BG)"

Frontend â€” Feature Overview
Navigation Structure

Home: Project picker cards with score distribution bars. Hero video background with compact header on scroll. Right-click â†’ Edit Brief / Rename / Delete.
Project â†’ Overview: Sticky header with project name + score bands + filter dropdowns + âš™ï¸ Edit Brief button. Assets grouped by folder path with section dividers.
Project â†’ Sub-folder: Normal grid view with folder cards + asset cards.
Detail/player view: Custom video player + right panel (Scores | Comments tabs).
Sidebar (within project)

Overview link (SVG home icon) â†’ project overview
Separator + FOLDERS label
Folder tree â€” collapsible, condensed vertical spacing
Drag-to-resize handle on right edge (160pxâ€“420px range)
Managed folders: no âœï¸ğŸ—‘ on hover, right-click â†’ "Edit via Project Settings"
Unmanaged folders: fully editable
â† All Projects â†’ home
Project Setup Modal (3 steps)

Step 1 â€” Identity: Company, Brand, Market, Business Group, Category, Default Language, Additional Languages
Step 2 â€” Organisation: Phases, Audiences
Step 3 â€” Channels: Per-phase platform/format selection with checkboxes
On save: config written to DB, managed folder tree auto-generated
On edit: disabled channels removed (with asset-count warning), new channels created
Overview Page

Sticky header: project name + score bands + two filter dropdowns + Has Comments toggle
Score dropdown: All / Not Green / Green / Amber / Red / Unscored
Status dropdown: All / Approved / Reviewed / Needs Attention / Unreviewed
ğŸ’¬ Has Comments toggle pill
Filters are additive â€” both applied simultaneously
Assets grouped by folder path, Untagged group at bottom
Asset Cards

Thumbnail with video scrub preview on hover
ACE score badge (number only, no "ACE" prefix) â€” top right, z-index above scrub preview
Duration overlay â€” bottom right, transparent white thin type with text-shadow, z-index above scrub preview
No score badge shown for unscored assets
Version number + â˜… Master pill in meta row
Comment count ğŸ’¬ n in meta row when > 0 (latest version only)
Audience tags with border-top divider
Review status badge (non-unreviewed only) with border-top divider, follows audience tag pattern
Right-click: Add Report / Move to folder / Delete
Drag onto folder cards to move
Detail / Player View

Header: Back, display name, filename (if renamed), version dropdown, Add/Replace Report button

Meta bar: Review status dropdown (leftmost, with vertical separator) â†’ phase, platform, format, master, audience tags, date â†’ âœï¸ Edit

Custom video player:

Play/pause button (SVG icons), click video to toggle
Scrub bar with progress fill, scrub head on hover, amber comment markers
Click (non-drag) on scrub bar â†’ seeks + switches to Comments tab + focuses input
Timecode display (current / total)
Mute button with live icon state
Fullscreen button (requestFullscreen on .vcol)
Download button (<a download> wired to /api/media/{version.id})
Right panel â€” tabbed (Scores | Comments n):

Scores tab:

SVG ring â€” coloured arc (green/amber/red), score number inside
Copy button: image to clipboard (Chrome/secure context), text fallback (execCommand), download fallback. Image: 80Ã—80 @ 2Ã— retina, transparent background
Category KPIs: one accordion open at a time, Attention open by default
Comments tab:

Comment list: timecode badge + text + date + delete button
Click comment â†’ seek + play to timecode
Amber pip markers on scrub bar; hover pip â†’ tooltip with timecode + text
Comment input: Enter to send (Shift+Enter for newline)
Copy all â†’ timecode â€” text per line
Review Status

Values: Unreviewed / Needs Attention / Reviewed / Approved
Detail view: dropdown in meta bar, leftmost, click to reveal list
Cards: badge for non-unreviewed only, .card-tags styling
Overview: Status filter dropdown
Tagging Modal

Triggered on first upload. Skipped for version uploads.
In managed folder: phase/platform/format hidden, blue "Will test as" banner, asks name/origin/language/master/audience
Outside managed folder: full manual tagging
Audience: single-select pills from project config
On confirm: metadata saved, auto-moved to correct managed folder
Score Bands Green â‰¥67, Amber 34â€“66, Red <34 Weighted: Branding Ã—5, Attention Ã—3, Processing/Emotional/Persuasion Ã—1

State
javascript


state = {
folderId, projectId, folders[], assets[], currentAsset,
draggingAssetId,
scoreFilter,    // 'all'|'notgreen'|'green'|'amber'|'red'|'unscored'
statusFilter,   // 'all'|'approved'|'reviewed'|'needs_attention'|'unreviewed'
commentsOnly    // boolean
}

currentVersionId   // version ID for active comments
currentComments[]  // comments for current version
playerScrubbing    // scrub drag state
scrubClickX        // click vs drag detection
sidebarResizing, sidebarStartX, sidebarStartW
Key Functions
Function	Purpose
initPlayer()	Wires video element events once at startup
togglePlay() / updatePlayBtn() / updatePlaybar()	Player state
toggleMute() / toggleFullscreen()	Mute + fullscreen
scrubStart/MoveDoc/EndDoc/Seek()	Scrub bar drag
renderMarkers()	Renders amber timeline markers on scrub bar
showMarkerTooltip(el, comment) / hideMarkerTooltip()	Pip tooltips
initSidebarResize()	Sidebar drag-to-resize
loadComments(versionId)	Fetches + renders comments
renderComments()	Renders list + calls renderMarkers
sendComment() / deleteComment(id)	Comment CRUD
copyComments()	Copy all as formatted text
seekToComment(timecode)	Seek + play
switchScoreTab(tab)	Toggle Scores/Comments panel
copyAceScore(ace, color, label) + dlBlob()	ACE clipboard/download
setReviewStatus(assetId, status)	API + local state + UI update
toggleStatusDropdown(e) / updateStatusBtn(status)	Status dropdown in meta bar
toggleOvDropdown(id, e) / setScoreFilter(v) / setStatusFilter(v) / toggleCommentsFilter()	Overview filter dropdowns
statusLabel(s)	Status value â†’ display string
escHtml(str)	XSS-safe string for comment rendering
renderBreadcrumb()	Header breadcrumb + action buttons
renderSidebar()	Folder tree
renderOverview() / renderGrid()	Main content area
makeCard(a) / makeFolderCard(f)	Card HTML builders
showTagModal() / renderTagModal() / submitTags()	Tagging flow
getBrainsuiteTestConfig(assetId)	Assembles Brainsuite submission payload
findTargetFolder(projectId, phase, platform, format)	Finds managed folder for auto-move
generateManagedFolders() / cleanupRemovedManagedFolders()	Project setup folder management
parsePPTX(file) / calcACE(cats)	PPTX parsing + score calculation
Key Design Decisions
Projects = top-level folders (no separate projects table)
Project config stored as JSON in folders.config on root folder
Folder structure IS the brief â€” auto-generated from channel config
Tagging drives location â€” asset auto-moves to correct folder on tag confirm
Versions: same filename = new version, different filename = new asset
Display name separate from base_name (filename)
All uploads are file copies in ~/Documents/GreenroomMedia/. Safe to hard-delete.
comment_count on assets query counts only latest version's comments (is_latest = 1)
Video served via /api/media/{version_id} (absolute path lookup) throughout
content_origin defaults to Brand; surfaces at per-asset level only
Language hidden in tagging modal unless project has additional languages defined
API Readiness
getBrainsuiteTestConfig(assetId) â€” walks folder tree to find test config, assembles complete Brainsuite submission payload. Returns null for non-testable assets. Ready to wire to API.

Code Delivery (Important for Future Sessions)
main.css â†’ send as standalone code block â†’ copy â†’ paste into static/css/main.css
app.js â†’ send as standalone code block â†’ copy â†’ paste into static/js/app.js
index.html â†’ HTML shell only, rarely needs changes
Python files â†’ use repair.py with S = chr(32)*4, S2 = chr(32)*8, N = chr(10)
VS Code is the editor. Python 3.14.3. Managed corporate Mac â€” python3 only
DB migrations use list comprehension: [conn.execute("ALTER TABLE...") for c,d in new_cols if c not in existing]
Targeted JS/CSS patches preferred over full file regeneration where possible (token efficiency)
Full file overwrites now viable for main.css and app.js individually given the split
Related Tools
AutoBS (Chrome extension) â€” Automates Brainsuite upload form. Captures ACE scores, category scores, KPI data. Authoritative reference for constrained field values.

BrainSurgeon (web app) â€” Parses Brainsuite PPTX reports. parsePPTX() and all supporting logic embedded in app.js.

Deferred / Backlog
Item	Notes
Brainsuite API integration	Auto-submit on upload, poll for results, auto-pair. Use getBrainsuiteTestConfig() as payload builder
Brainsuite field validation	Business Group, Category, Market, Brand, Language as constrained dropdowns. Source: AutoBS field definitions
futureTests array in DEFAULT_CHANNELS	Dormant scaffolding for multi-test platforms. Defer to API session
Cloud/remote deployment	Private server, always-on, multi-user. Tailscale currently used as interim solution
Auto-launcher	Wrap python3 launch.py in Automator app, add to Login Items
Browser back button	No history.pushState() calls. Fix: push state at each navigation point, listen for popstate
Sort	By name, date, ACE score
Download	Single asset + project-level zip preserving folder structure
Version ACE delta	â†‘/â†“ indicator vs previous version
Version stacking â€” fuzzy match	Handle _v2 suffix not creating a new asset
Sidebar drag-to-folder	Drag asset cards onto sidebar folders
Folder drag	Pick up entire folders for mass moves
List view toggle	Alternative to card grid
Stage 2 filter extensions	Filter by platform, phase, format, master status
Display asset support	HTML5 upload + framed playback or video proxy
Static/image asset support	JPG/PNG for Meta/Pinterest statics
Cohorts	Concept not yet defined
Display asset grouping	Sets of three sizes (MPU, Leader, Sky) â€” solution TBD
SVG logo rendering	Slight outline artefact visible on hero at large size in Safari/Chrome â€” cosmetic, low priority
