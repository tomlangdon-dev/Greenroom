
My thought process
Greenroom ‚Äî Context Update (Session 2)

Backend ‚Äî New Routes (this session)
Route	Method	Purpose
/api/media/<version_id>	GET	Serves video by version ID ‚Äî replaces /uploads/videos/<filename> throughout
/api/versions/<vid>/comments	GET	List comments for a version
/api/versions/<vid>/comments	POST	Add comment {text, timecode}
/api/comments/<cid>	DELETE	Delete a comment
/api/assets/<aid>/status	PUT	Set review status {status}
Assets query now returns: review_status, content_origin, language

Pending backend work: comment_count field on /api/assets response ‚Äî subquery counting comments on latest version only (is_latest = 1). Required for Has Comments filter and card badge.

Database ‚Äî New / Updated


comments ‚Äî id, version_id (CASCADE), timecode (INTEGER seconds),
text (TEXT), created_at
review_status field on assets ‚Äî values: unreviewed, needs_attention, reviewed, approved (default unreviewed)

Frontend ‚Äî Feature Changes
Video player (detail view) Native <video controls> replaced with custom playbar:

Play/pause button (SVG icons, toggles on video click too)
Scrub bar ‚Äî drag to seek, progress fill, scrub head on hover
Timecode display ‚Äî current / total
Download button ‚Äî <a download> wired to /api/media/{version.id} with original filename
Click (non-drag) on scrub bar ‚Üí switches to Comments tab, focuses input
Right panel ‚Äî tabbed .scol now has two tabs: Scores | Comments (n)

Scores panel: ACE ring + category KPIs
Comments panel: list, input, send (Enter), delete, copy all
ACE score display

SVG ring replacing large number ‚Äî coloured arc, score inside
Categories: one open at a time, Attention open by default
Copy button: image to clipboard (Chrome/secure context), text fallback (execCommand), download fallback
Copied image: 80√ó80 @ 2√ó retina, transparent background, ring + score only
Timeline comments

Amber markers on scrub bar at comment timecodes
Click marker ‚Üí seek + play
Click scrub bar (non-drag) ‚Üí seek + open comments tab
Comment list items: timecode badge, text, date, delete button
Copy all ‚Üí timecode ‚Äî text per line, execCommand
Review status

Values: Unreviewed / Needs Attention / Reviewed / Approved
Detail view: leftmost element in meta tag bar, vertical separator, click to reveal dropdown (not four pills)
Cards: badge shown only for non-unreviewed, uses .card-tags styling (border-top, consistent padding)
Overview: Status dropdown filter (see below)
Overview filters Flat pill bar replaced with two dropdowns + one toggle:

Score dropdown: All / Not Green / Green / Amber / Red / Unscored
Status dropdown: All / Approved / Reviewed / Needs Attention / Unreviewed
üí¨ Has Comments toggle pill (requires comment_count backend field)
Filters are additive ‚Äî both applied simultaneously
Active filter highlighted indigo on button
Comment count on cards Shows üí¨ n in card meta row when comment_count > 0. Latest version only.

UI improvements

Sidebar folder rows: condensed vertical padding
Sidebar: drag-to-resize handle on right edge (160px‚Äì420px range)
Project cards: folder count removed
State
javascript


state.scoreFilter      // 'all' | 'notgreen' | 'green' | 'amber' | 'red' | 'unscored'
state.statusFilter     // 'all' | 'approved' | 'reviewed' | 'needs_attention' | 'unreviewed'
state.commentsOnly     // boolean ‚Äî Has Comments toggle
// state.overviewFilter removed
Key New Functions
Function	Purpose
initPlayer()	Wires video element events once at startup
togglePlay() / updatePlayBtn() / updatePlaybar()	Player state
scrubStart/MoveDoc/EndDoc/Seek()	Scrub bar drag
initSidebarResize()	Sidebar drag-to-resize
loadComments(versionId)	Fetches + renders comments for version
renderComments()	Renders comment list + calls renderMarkers()
renderMarkers()	Renders timeline markers on scrub bar
sendComment() / deleteComment(id)	Comment CRUD
copyComments()	Copy all as formatted text
seekToComment(timecode)	Seek + play to timecode
switchScoreTab(tab)	Toggle Scores/Comments panel
copyAceScore(ace, color, label) + dlBlob()	ACE clipboard/download
setReviewStatus(assetId, status)	API call + local state + UI update
toggleStatusDropdown(e) / updateStatusBtn(status)	Status dropdown in meta bar
toggleOvDropdown(id, e) / setScoreFilter(v) / setStatusFilter(v) / toggleCommentsFilter()	Overview filter dropdowns
statusLabel(s)	Status value ‚Üí display string
escHtml(str)	XSS-safe string for comment rendering
Backlog Updates
Item	Status
Simple comments	‚úÖ Done ‚Äî timeline comments with timecode, markers, copy
ACE copy	‚úÖ Done
Video download	‚úÖ Done
Review status	‚úÖ Done
comment_count backend field	‚è≥ Pending ‚Äî needed for card badge + Has Comments filter
Browser back button	Deferred
Brainsuite API integration	Deferred
All other backlog items	Unchanged
